!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t,e){var a=function(e,a){if(e){var i=this;this.element=t(e),this.lang=a.lang||"cn",this.language=n[this.lang],this.startDate=a.startDate||this.now(),this.dateCycle=a.dateCycle||7,this.endDate=this.getEndDate(),this.onSelectDay=a.onSelectDay||function(){},this.maxSelectCount=a.maxSelectCount||5,this.minSelectCount=a.minSelectCount||1,this.continuity=a.continuity||!1,this.selectDayArr=a.selectDayArr||[],this.onConfirm=a.onConfirm||function(){},this.wrapper=t('<div class="miniDatepickerWrapper"></div>'),this.create(),this.element.on("click",function(){i.showDatePicker()})}};a.prototype={create:function(){var e=this,a=this.getMonths(),n=this.language.daysShort,i=this.language.button,r=t('<div class="miniDatepickTop"></div>'),s=t('<div class="minidateweekdays"></div'),d=t('<span><i class="iconfont icon-rili"></i>'+this.dateCycle+this.language.day+"</span>"),c=t('<span><i class="iconfont icon-clear"></i></span>');c.on("click",function(){l.find(".active").removeClass("active"),l.find("[data-active]").removeAttr("data-active"),e.selectDayArr=[]}),r.append(d).append(c);var o=t("<ul></ul>");n.map(function(e){var a=t("<li></li>");a.html(e),o.append(a)}),s.append(o);var l=t('<div class="miniDatepickContent"></div>');a.map(function(t){var a=e.draw(t.year,t.month);l.append(a)});var h=t('<div class="miniDatepickBottom"></div>');i.map(function(a,n){var i=t("<button></button>");i.prop("type","button").addClass("miniDateButton").html(a),i.on("click",function(){if(n==e.minSelectCount){if(0==e.selectDayArr.length)return alert("请至少选择"+e.minSelectCount+"预约时间"),!1;e.onConfirm(e.selectDayArr)}e.hideDatePicker()}),h.append(i)}),this.wrapper.append(r).append(s).append(l).append(h),t("body").append(this.wrapper)},getMonths:function(){for(var t=[],e=this.startDate.split("-"),a=this.endDate.split("-"),n=parseInt(e[0]),i=parseInt(e[1]),r=parseInt(a[0]),s=parseInt(a[1]);n<=r;)if(n===r){for(;i<=s;)t.push({year:n,month:i}),i++;n++}else i>12&&(i=1,n++),t.push({year:n,month:i}),i++;return t},draw:function(e,a){var n=this,r=this.getStartDateInfo(),s=new Date(e,a-1,1).getDay(),d=new Date(e,a,0).getDate();r.year==e&&r.month==a&&(s=r.weekday);var c=t('<div class="month_'+a+'"></div>'),o=t('<div class="miniDateMonth"></div>'),l='<span class="offset-'+s+'">'+n.language.monthsShort[a-1]+"</span>";o.append(l);var h=[],u=t("<ul></ul>");for(i=1;i<=s;i++)h.push(0);for(i=1;i<=d;i++)h.push(i);for(;h.length;)for(i=1,len=h.length;i<=len;i++)if(h.length)if(sValue=h.shift(),sValue){var p=e+"-"+this.format(a)+"-"+this.format(sValue),m=this.getWeek(p);if(p>=this.startDate&&p<=this.endDate){var f=t("<li></li>");f.attr("data-date",p).attr("data-week",m);var v=t('<span class="mini_day">'+sValue+"</span>"),y=t('<span class="mini_am">'+n.language.meridiem[0]+"</span>"),g=t('<span class="mini_pm">'+n.language.meridiem[1]+"</span>");this.selectDayArr.length>0&&t.each(this.selectDayArr,function(t,e){parseInt(e.datestr.replace(/-/g,""))==parseInt(p.replace(/-/g,""))&&(1==e.am&&(f.attr("data-active","true"),y.addClass("active")),1==e.pm&&(f.attr("data-active","true"),g.addClass("active")),1==e.am&&1==e.pm&&(f.attr("data-active","true"),v.addClass("active")))}),this.onClickHandle(0,v),this.onClickHandle(1,y),this.onClickHandle(1,g),f.append(v).append(y).append(g),u.append(f),new Date(e,a-1,sValue)}}else(f=t("<li></li>")).addClass("disabled"),u.append(f);return c.append(o).append(u),c},getStartDateInfo:function(){var t={},e=this.startDate,a=new Date(e);return t.year=a.getFullYear(),t.month=a.getMonth()+1,t.weekday=a.getDay(),t},getWeek:function(t){var e=this.getTimeByTimeStr(t);return new Date(e[0],e[1]-1,e[2]).getDay()},format:function(t){return t.toString().replace(/^(\d)$/,"0$1")},getEndDate:function(){return!!this.dateCycle&&this.day(this.dateCycle,this.startDate)},newDate:function(){return new Date},getTimeByTimeStr:function(t){return t.split("-")},now:function(){var t=this.newDate(),e=t.getFullYear(),a=t.getMonth()+1,n=t.getDate();return e+"-"+(a<10?"0"+a:a)+"-"+(n<10?"0"+n:n)},day:function(t,e){var a=this.newDate();e&&(e=this.getTimeByTimeStr(e),a=new Date(e[0],e[1]-1,e[2])),a.setDate(a.getDate()+t);var n=a.getFullYear(),i=a.getMonth()+1,r=a.getDate();return n+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r)},month:function(t,e){var a=this.newDate();e&&(e=this.getTimeByTimeStr(e),a=new Date(e[0],e[1]-1,e[2])),a.setMonth(a.getMonth()+t);var n=a.getFullYear(),i=a.getMonth()+1,r=a.getDate();return n+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r)},year:function(t,e){var a=this.newDate();e&&(e=this.getTimeByTimeStr(e),a=new Date(e[0],e[1]-1,e[2])),a.setFullYear(a.getFullYear()+t);var n=a.getFullYear(),i=a.getMonth()+1,r=a.getDate();return n+"-"+(i<10?"0"+i:i)+"-"+(r<10?"0"+r:r)},dateDiff:function(t,e){var a,n,i;return a=this.getTimeByTimeStr(t),n=new Date(a[1]+"-"+a[2]+"-"+a[0]),a=this.getTimeByTimeStr(e),i=new Date(a[1]+"-"+a[2]+"-"+a[0]),parseInt(Math.abs(n-i)/1e3/60/60/24)},onClickHandle:function(e,a){var n=this;a.on("click",function(){var a=t(this),i=a.parent("li"),r=a.hasClass("active"),s=a.hasClass("mini_am"),d=a.hasClass("mini_pm"),c=i.attr("data-date");if(!i.attr("data-active")){var o=n.maxSelected();if(0==o)return o}if(n.selectDayArr.length>0&&n.continuity&&0==n.isSelected(c))return alert("不支持非连续性选择"),!1;switch(e){case 0:if(r)i.removeAttr("data-active").find("span").removeClass("active");else{i.attr("data-active",!0).find("span").addClass("active");u="选择了"+(h={datestr:i.attr("data-date"),am:!0,pm:!0}).datestr+"全天";n.onSelectDay(i,h,u)}break;case 1:if(r)1==i.find(".active").length&&i.removeAttr("data-active"),a.removeClass("active");else{if(i.attr("data-active",!0),a.addClass("active"),s)l=n.language.meridiem[0];if(d)var l=n.language.meridiem[1];var h={datestr:i.attr("data-date"),am:s,pm:d},u="选择了"+h.datestr+l;n.onSelectDay(i,h,u)}}n.storeSaveDate()})},isSelected:function(t){var e=this,a=0;return this.selectDayArr.forEach(function(n,i){var r=e.dateDiff(n.datestr,t);if(1==r||0==r)return a=1,!0}),1==a},maxSelected:function(){return this.selectDayArr.length!=this.maxSelectCount||(alert("仅支持连续选择"+this.maxSelectCount+"天"),!1)},storeSaveDate:function(){var e=this,a=t("li[data-active]");e.selectDayArr=[],t.each(a,function(a,n){var i={datestr:"",am:!1,pm:!1};n=t(this),i.datestr=n.attr("data-date"),n.find("span").eq(1).hasClass("active")&&(i.am=!0),n.find("span").eq(2).hasClass("active")&&(i.pm=!0),e.selectDayArr.push(i)})},hideDatePicker:function(){this.wrapper.removeClass("fadeInRight"),t("body").removeClass("openMiniDate")},showDatePicker:function(){this.wrapper.addClass("fadeInRight"),t("body").addClass("openMiniDate")}},t.fn.minidatepicker=function(n){var i=Array.apply(null,arguments);i.shift();var r;return this.each(function(){var s=t(this),d=s.data("minidatepicker"),c="object"==typeof n&&n;if(d||s.data("datetimepicker",d=new a(this,t.extend({},t.fn.minidatepicker.defaults,c))),"string"==typeof n&&"function"==typeof d[n]&&(r=d[n].apply(d,i))!==e)return!1}),r!==e?r:this},t.datePickerPrototype=new a,t.fn.minidatepicker.defaults={};var n=t.fn.minidatepicker.language={en:{day:"days",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["am","pm"],button:["cancel","confirm"]},cn:{day:"天",days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["日","一","二","三","四","五","六"],daysMin:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],meridiem:["上午","下午"],button:["取消","确认"]}}});